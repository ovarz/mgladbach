document.addEventListener('DOMContentLoaded',()=>{const generateButton=document.querySelector('.button-generate');const frameToCapture=document.getElementById('result-preview-frame');const downloadButton=document.getElementById('download-report-btn');let mySkillLineChart;const skillMappings=[{inputId:'pace-input',displayId:'pace-display',label:'Pace'},{inputId:'shooting-input',displayId:'shooting-display',label:'Shooting'},{inputId:'passing-input',displayId:'passing-display',label:'Passing'},{inputId:'dribbling-input',displayId:'dribbling-display',label:'Dribbling'},{inputId:'defending-input',displayId:'defending-display',label:'Defending'},{inputId:'physical-input',displayId:'physical-display',label:'Physical'},];const skillLabels=skillMappings.map(m=>m.label);generateButton.addEventListener('click',()=>{const skillValues=[];skillMappings.forEach(mapping=>{const inputElement=document.getElementById(mapping.inputId);const displayElement=document.getElementById(mapping.displayId);let value=parseInt(inputElement.value)||0;if(value<0)value=0;if(value>10)value=10;skillValues.push(value);displayElement.innerHTML=`${value}`});const coachComment=document.getElementById('comment-input').value.trim();const commentDisplay=document.getElementById('comment-display');const reportChartContainer=document.getElementById('report-content');commentDisplay.innerHTML=`<div class="coach-comments-container">${coachComment || "No comment provided."}</div>`;reportChartContainer.innerHTML='';const canvas=document.createElement('canvas');canvas.id='skillLineChart';canvas.style.width='100%';canvas.style.height='300px';reportChartContainer.appendChild(canvas);const ctx=canvas.getContext('2d');if(mySkillLineChart){mySkillLineChart.destroy()}const customColor='#23d468';mySkillLineChart=new Chart(ctx,{type:'line',data:{labels:skillLabels,datasets:[{label:'Player Skills',data:skillValues,fill:!1,borderColor:customColor,tension:0.1,pointBackgroundColor:customColor,pointBorderColor:'#fff',pointRadius:5,pointHoverRadius:7}]},options:{responsive:!1,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,min:0,max:10,ticks:{stepSize:2}},x:{grid:{display:!1}}},plugins:{legend:{display:!1},title:{display:!1}}}})});downloadButton.addEventListener('click',()=>{const elementToCapture=frameToCapture;const chartCanvas=document.getElementById('skillLineChart');if(!chartCanvas){alert("Please generate the report first.");return}html2canvas(elementToCapture,{scale:3.5,useCORS:!0}).then(canvas=>{const imageDataURL=canvas.toDataURL('image/jpeg',0.9);const link=document.createElement('a');link.href=imageDataURL;link.download='Player_Report_'+new Date().toISOString().slice(0,10)+'.jpg';document.body.appendChild(link);link.click();document.body.removeChild(link)}).catch(error=>{console.error('Download failed:',error);alert('Could not download report. Check the console for details.')})})})