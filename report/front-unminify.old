document.addEventListener('DOMContentLoaded', () => {
    const generateButton = document.querySelector('.button-generate');
    // Elemen utama yang akan di-capture (tetap result-preview-frame)
    const frameToCapture = document.getElementById('result-preview-frame');
    const downloadButton = document.getElementById('download-report-btn');

    // ⭐ PEMETAAN INFORMASI PEMAIN
    const playerInfoMappings = [
        { inputId: 'name-input', displayId: 'name-display', label: 'Name' },
        { inputId: 'birth-input', displayId: 'birth-display', label: 'Date of Birth' },
        { inputId: 'age-input', displayId: 'age-display', label: 'Age Group / Team' },
        { inputId: 'coach-input', displayId: 'coach-display', label: 'Coach' },
    ];
    
    // --- Fungsi Generate Report ---
    generateButton.addEventListener('click', () => {
        
        // ⭐ BAGIAN 1: PROSES INFORMASI PEMAIN & COACH
        playerInfoMappings.forEach(mapping => {
            const inputElement = document.getElementById(mapping.inputId);
            const displayElement = document.getElementById(mapping.displayId);
            
            // Ambil nilai teks, hapus spasi awal/akhir
            // Ambil dari input type="text"
            const value = inputElement.value.trim(); 
            
            // Tampilkan nilai di elemen rpf-display yang sesuai (HTML Anda)
            displayElement.innerHTML = `
                ${value || '-'}</span>
            `;
        });
        
        // CATATAN: Karena chart dan comment dibuang, tidak ada lagi logika rendering di sini.
    });

    // --- Fungsi Download Report (Hanya Pemeriksaan Sederhana) ---
    downloadButton.addEventListener('click', () => {
        const elementToCapture = frameToCapture; 
        
        // Pemeriksaan sederhana: memastikan input Nama sudah diisi sebagai indikasi "generate"
        const nameInput = document.getElementById('name-input');
        if (!nameInput || nameInput.value.trim() === '') { 
            alert("Please generate the report first by filling in the Name field.");
            return;
        }

        // Gunakan html2canvas untuk menangkap elemen HTML
        html2canvas(elementToCapture, {
            // Tetap gunakan scale tinggi untuk kualitas download (2480px)
            scale: 3.5, 
            useCORS: true 
        }).then(canvas => {
            const imageDataURL = canvas.toDataURL('image/jpeg', 0.9); 

            const link = document.createElement('a');
            link.href = imageDataURL;
            link.download = 'Report_' + (document.getElementById('name-input').value.trim() || 'Player') + '_' + new Date().toISOString().slice(0, 10) + '.jpg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }).catch(error => {
            console.error('Download failed:', error);
            alert('Could not download report. Check the console for details.');
        });
    });

});